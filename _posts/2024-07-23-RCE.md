---
layout: post
title:  "RCE"
date:   2024-07-23
categories: web_security vulnerabilities
---

# 远程代码执行(Remote Command/Code Execute)

​		概述：RCE漏洞，可以让攻击者直接向后台服务器远程注入操作系统命令或代码，从而控制后台。

​		原因：一般出现这种漏洞的原因，是因为应用系统从设计上需要给用户提供指定的远程命令操作的接口。

## 漏洞危害

​		1、获取服务器权限

​		2、获取敏感数据文件

​		3、写入恶意代码`getshell`

​		4、植入木马病毒、勒索软件等

## 命令拼接符号

| Windows命令拼接符号 | 效果                             |
| :-----------------: | :------------------------------- |
|         &&          | 左边命令执行成功，右边才执行     |
|          &          | 简单的拼接                       |
|         \|          | 上一条命令输出作为下一条命令参数 |
|        \|\|         | 左边的命令执行失败，右边的才执行 |



| Linux命令拼接符号 | 效果                     |
| ----------------- | ------------------------ |
| ;                 | 没有任何逻辑关系的连接符 |
| &&                | 同Windows                |
| \|                | 同Windows                |
| \|\|              | 同Windows                |
| &                 | 任务后台执行             |

## PHP的RCE涉及函数

| 命令注入            | 功能                                                      |
| ------------------- | --------------------------------------------------------- |
| system()            | 执行外部程序，并且显示输出                                |
| exec()/shell_exec() | 通过shell环境执行命令，并且将完整的输出以字符串的方式返回 |
| pcntl_exec()        | 在当前进程空间执行指定程序                                |
| passthru()          | 执行外部程序并显示原始输出                                |
| popen()             | 打开进程文件指针                                          |
| proc_open()         | 执行一个命令，并且打开用来I/O的文件指针                   |



| 代码注入                                | 功能                                                       |
| --------------------------------------- | ---------------------------------------------------------- |
| eval(code)                              | 把字符串code作为php代码执行                                |
| assert()                                | 检查一个断言是否为false                                    |
| preg_replace()                          | 执行一个正则表达式的搜索和替换                             |
| create_function()                       | 创建一个匿名函数并返回函数名称                             |
| call_user_func()/call_user_func_array() | 把第一个参数作为回调函数使用                               |
| usort(/uasort()                         | 使用用户自定义的比较函数对数组中的值进行排序并保持索引关联 |

## RCE防御

​	1、如果使用的是开源框架，一定要升到最新版本

​	2、尽量不要使用命令执行的函数

​	3、如果必须要使用，需要做白名单处理

​	4、用正则表达式对用户输入的内容做处理

​	5、使用WAF



